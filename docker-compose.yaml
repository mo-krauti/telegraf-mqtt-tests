configs:
  telegraf_config:
    file: ./telegraf.conf

services: 
  telegraf:    
    image: telegraf:1.34
    #build:
    #    context: ./
    #    dockerfile: telegraf.dockerfile
    network_mode: host
    env_file: .env
    #command: /bin/sh -c 'sleep 1000'
    command: /bin/sh -c 'rm /var/log/telegraf/*; rm -r /var/log/telegraf/buffer; telegraf'
    configs:
      - source: telegraf_config
        target: /etc/telegraf/telegraf.conf
    volumes:
      - telegraf_logs:/var/log/telegraf

  mqtt:
    image: eclipse-mosquitto:latest
    network_mode: host

  tester:
    build: ./
    network_mode: host
    env_file: .env
    volumes:
      - telegraf_logs:/var/log/telegraf

volumes:
   telegraf_logs: 
